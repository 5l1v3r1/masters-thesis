(źródło: lucamascaro) Jest wiele sposobów przeprowadzania resetu hasła użytkownika i nie jest tak prosto wymyślić taki, dzięki któremu każdy będzie mógł zresetować hasło każdego użytkownika usługi. Programistom serwisu internetowego Mennicy jednak się to udało. Idąc z duchem czasu operatorzy systemów kart miejskich postanowili jakiś czas temu udostępnić obywatelom możliwość doładowywania karty przez internet. Inicjatywa ze wszech miar chlubna, choć wdrożenie – jak to często bywa – niezbyt szczęśliwe. Należy jednak oddać honor firmie – na zgłoszenie o błędzie zareagowała szybko i profesjonalnie, a błędy zostały usunięte. Firma Mennica Polska, dostawca systemów Warszawskiej Karty Miejskiej, wrocławskiej URBANCARD, Bydgoskiej Karty Miejskiej oraz lubelskiej Karty Biletu Elektronicznego, opracowała także serwis www.kartamiejska.pl. Możemy za jego pomocą (lub jego elementów osadzonych na stronach poszczególnych operatorów miejskich) zarejestrować swoje konto, przypisać do niego kartę oraz ją załadować. Jeden z naszych czytelników wskazał nam ciekawy błąd w serwisie (o którym wspomnimy na końcu wpisu), a przy okazji weryfikacji jego zgłoszenia zauważyliśmy, że programiści tworzący mechanizm przypominania hasła poszli bardzo nietypową drogą. Przyglądając się serwisom internetowym mamy w zwyczaju sprawdzać proces odzyskiwania hasła (godne potępienia przypadki umieszczamy potem na naszej corocznej liście). Tak też zrobiliśmy i tym razem. Po założeniu konta na stronie kartamiejska.pl „zapomnieliśmy” hasła i poprosiliśmy o jego przypomnienie. Co prawda nie dostaliśmy pocztą naszego starego hasła, ale link do resetu wyglądał bardzo ciekawie. Link, znajdujący się w wiadomości, wygląda na pierwszy rzut oka całkiem nieźle. Ale zaraz, czy to jest kodowanie base64? Ciekawe, co tam zamieszczono. Pierwsza myśl, jaka nam przyszła do głowy, brzmiała „nie, to niemożliwe, żeby wystarczyło podmienić adres email na cudzy, by zresetować hasło innego użytkownika”. Mimo to postanowiliśmy założyć drugie konto i przetestować ten pomysł. Jak się pewnie domyślacie, czytacie ten artykuł, ponieważ zadziałało. Wystarczyła zatem znajomość adresu email dowolnego użytkownika serwisu, by można było zmienić mu hasło. Efekt działania zmodyfikowanego linku Jedyne weryfikacje, jakie odbywały się po stronie serwera, to czy adres email istnieje w bazie oraz czy data i godzina z linku nie są starsze o więcej niż 12h od obecnego czasu. Czemu programiści nie postanowili skorzystać z lepszych zabezpieczeń? To pewnie pozostanie ich słodką tajemnicą. Błąd występował w serwisie kart warszawskich, wrocławskich oraz bydgoskich. Kart lubelskich nie mogliśmy zweryfikować, ponieważ nie udało się nam przejść procesu rejestracji konta bez działającego numeru karty. Dla kart bydgoskich i wrocławskich występowała jedynie drobna różnica – godzina zapisana była w formacie AM/PM. Na szczęście w nieszczęściu nic nie wskazuje na to, by na serwerze kartamiejska.pl przechowywane były dane osobowe użytkowników systemu. Po przejęciu cudzego konta można jedynie: Nie są to jak widać poważne konsekwencje, jednak biorąc pod uwagę ambitne plany rozbudowy funkcjonalności karty miejskiej, warto zabezpieczyć system, zanim znajdą się w nim bardziej wrażliwe dane. Na problem resetowania haseł trafiliśmy przy okazji analizy zgłoszenia innego błędu. Nasz Czytelnik LukOne poinformował, że po otwarciu publicznie dostępnego linku wykorzystywanego do osadzenia fragmentów strony kartamiejska.pl w witrynie ztm.waw.pl, można było podejrzeć historię wszystkich zakupów doładowań kart miejskich przez internet. Według naszej wstępnej oceny dostępne w sieci były dane ponad 30 tysięcy transakcji takie jak: Ponownie nie były to dane szczególnie wrażliwe, jednak brak jakiejkolwiek walidacji zapytań po stronie serwera (wystarczyło zmieniać numer transakcji jako parametru zapytania na przykładzie poniżej) wskazywał na poważne zaniedbania programistów. Opisane powyżej błędy przekazaliśmy w czwartek na adres kontaktowy podany na stronie. Wczoraj otrzymaliśmy informację zwrotną. Pracownicy Mennicy nie tylko poinformowali, że błędy zostały poprawione, ale także podziękowali za przesłane zgłoszenie i zapowiedzieli, że poddadzą całą witrynę dokładnemu audytowi. Chyba jedyne, co mogli zrobić lepiej, to przeprowadzić audyt bezpieczeństwa przed wdrożeniem kodu w środowisku produkcyjnym :),Adam