Kolejny zwykły dzień dla użytkowników domowych ruterów przynosi kolejne poważne błędy umożliwiające zdalne wykonanie kodu przez atakującego. Do tego producent nie załata tych błędów jeszcze przez wiele dni. W co najmniej kilkunastu modelach ruterów D-Linka obecny jest bardzo poważny błąd pozwalający na przejęcie całkowitej kontroli nad urządzeniem. Na dokładkę podobno nie da się z nim nic zrobić dopóki producent nie wyda aktualizacji oprogramowania. Niezawodny Craig z dev/ttyS0 tym razem zabrał się za flagowy model D-Linka, czyli DIR 890L, trójpasmowego, sześcioantenowego potwora za 1000 PLN. Po wypakowaniu oprogramowania urządzenia postanowił przyjrzeć się interfejsowi HNAP, służącemu do zarządzania ruterem przez operatora lub do konfiguracji urządzenia na etapie jego uruchamiania. Do tej pory błędy odkrywano głównie w interfejsach HTTP czy UPnP, zatem czas był już najwyższy znaleźć nowy wektor ataku. Kosmiczny D-Link z komicznym błędem Za obsługę wszystkich żądań do serwera WWW odpowiada jeden plik binarny. Jego analiza zajęła trochę czasu, ale jak zawsze się opłaciła. Craig znalazł polecenie, które korzystało z funkcji system i przyjmowało parametry od użytkownika. Pozostawało jeszcze tylko znaleźć sposób na ominiecie uwierzytelnienia. Okazało się, że istnieje furtka – w jednym ze scenariuszy oprogramowanie sprawdza, czy nagłówek żądania równy jest http://purenetworks.com/HNAP1/GetDeviceSettings, jednak ze względu na błąd weryfikacji zamiast weryfikować czy nagłówek zgadza się z tym ciągiem, sprawdza jedynie, czy się od niego zaczyna. Daje to możliwość skonstruowania takiego żądania do urządzenia, które nie będzie wymagało uwierzytelnienia i jednocześnie pozwoli na wykonanie dowolnego polecenia. Można w ten sposób np. włączyć serwer telnetd, który domyślnie uruchamia się z uprawnieniami roota: Jeśli ruter udostępnia interfejs administracyjny z zewnątrz możliwe jest zdalne przeprowadzenie ataku. Co prawda firewall zablokuje połączenie na domyślny port usługi telnet, wystarczy jednak ubić serwer WWW i uruchomić telnetd na tym samym porcie: Craig poprosił zaprzyjaźnioną firmę o ustalenie, które inne urządzenia zawierają ten sam błąd i otrzymał listę kilkunastu modeli. Z kolei D-Link opublikował tego samego dnia informację o tym samym błędzie, zgłoszonym przez innego badacza, Zhang Wei z zespołu Qihoo360 ADLAB. Lista podatnych modeli wg D-Linka jest nieco inna niż lista Craiga, zatem na wszelki wypadek poniżej publikujemy kombinacje obu: Niestety D-Link w swoim komunikacie dla niektórych modeli wskazuje tak odległe daty aktualizacji oprogramowania jak nawet koniec czerwca 2015 a interfejsu HNAP nie da się w żadne znany sposób wyłączyć. Pozostaje odcięcie rutera od dostępu z zewnątrz lub instalacja alternatywnego oprogramowania.,Adam