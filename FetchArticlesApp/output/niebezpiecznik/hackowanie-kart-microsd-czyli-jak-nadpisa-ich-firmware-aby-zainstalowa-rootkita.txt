Niewiele osób zdaje sobie sprawę z tego, że karty *SD to tak naprawdę małe komputery. Można nadpisać ich firmware i uruchomić na karcie własny kod, co umożliwia przeprowadzenie ataków Man in the Middle. Tak, nie przywidziało wam się, można uruchomić kod bezpośrednio w pamięci karty… Po co karcie SD firmware i mikrokontroler? Każda pamięć typu flash (tj. miroSD, SD, MMC, eMMC, iNAND) wyposażona jest nie tylko w chip “pamięci flash” ale również taniutki mikrokontroler, który zawiera firmware sterujący pracą karty (zazwyczaj 8051 lub ARM7 CPU 100MHz). Jest to konieczne ze względu na to, że pamięć typu flash prawie zawsze zawiera bad sectory. Zadaniem mikrokontrolera jest umożliwienie pracy algorytmom korekcji błędów, dzięki czemu poszatkowana bad sectorami karta pamięci przedstawia się systemowi operacyjnemu użytkownika jako ciągła, “dobra” pamięć. Na marginesie, chińskie podróbki pendrive’ów i kart SD, które raportują systemowi większą liczbę gigabajtów niż rzeczywiście posiadają, to właśnie nic innego jak najtańsze i najmniejsze pamięci, którym przeprogramowano firmware tak, aby przedstawiał nośnik jako większy niż w rzeczywistości. Firmware można “złośliwie” przeprogramować Firmware niektórych mikrokonrolerów na kartach SD można “zaktualizować”. Jak informują badacze bunnie i xobs, którzy zajęli się głównie mikrokontrolerami producenta Appotech, aby wejść w procedurę aktualizacji firmware’u karty SD wystarczy wysłać do karty serię odpowiednich komend — chwilę później karta jest gotowa na przyjęcie 512 bajtów, które uruchomi w swoim środowisku. Jakie ryzyko to stwarza? Atakujący po wgraniu swojego firmware’u na kartę ofiary może wykonywać klasyczne ataki MitM, w ramach których będzie przechwytywał dane i wysyłał fałszywe informacje do systemu ofiary. Przykładowo, atakujący może uniemożliwić usunięcie z karty konkretnych danych (np. klucza kryptograficznego) albo wręcz podstawić swój. W przypadku “usunięcie” złośliwy firmware oczywiście będzie raportował operację zakończoną powodzeniem, ale w rzeczywistości sektory zawierające klucz nie zostaną nadpisane. Z tego powodu nie należy ufać jakimkolwiek algorytmom do “bezpiecznego” usuwania danych z nośników SD — jeśli chcecie się czegoś trwale pozbyć z takiej karty, najlepiej fizycznie ją zniszczcie. To samo dotyczy dysków SSD i pendrive’ów Badacze, którzy wyniki swoich badań przedstawili na trwającym właśnie konwencie 30C3 podkreślają, że chociaż badali mikrokontrolery tylko jednego producenta, to metoda ataku, którą przedstawili jest uniwersalna. Powinna zadziałać także na mikrokontrolery innych producentów kart SD ale również pendrive’ów i dysków SSD, bo i tam wykorzystywane są podobne rozwiązania. Jednej osobie już udało się zainstalować Linuksa w pamięci dysku twardego (nie na “powierzchni” dysku twardego!). Jeszcze jedno zastosowanie mikrokontrolera na kartach SD… Badacze sugerują również, że skoro firmware kart SD można przeprogramować, to mogę one być dobrą (i dużo tańszą!) alternatywą dla modułów Arduino, które wykorzystują mniej wydajny mikrokontroler: 8 bit/16MHz. Co ciekawe, to właśnie niski koszt mikrokontrolera na karcie SD (ok.15 centów) sprawia, że bardziej opłaca się go instalować na kartach niż przeprowadzać ręczną weryfikację bad sectorów w fabrykach. To wyjaśnia także, zagadkę dlaczego karty SD są tańsze niż czyste chipy pamięci flash o tej samej pojemności (te drugie po prostu nie zawierają ukrywanych programowo bad blocków). PS. To już druga (i nie ostatnia) prezentacja z 30C3, którą opisujemy na łamach Niebezpiecznika (dostępny jest także jej streaming). Zapraszamy także do lektury opisu wykładu dotyczącego hackowania bankomatów poprzez port USB. ,igH