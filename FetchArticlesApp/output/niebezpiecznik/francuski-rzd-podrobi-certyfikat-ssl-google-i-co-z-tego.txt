Podlegający francuskiej agencji do spraw cyberbezpieczeństwa (ANSSI) urząd certyfikacyjny (CA) wygenerował fałszywe certyfikaty dla kilku domen Google. To pozwalało np. podsłuchiwać połączenie z GMailem, o ile połączenie ofiary przechodziło przez urządzenia na których wykorzystano ten certyfikat. Kto i po co podrabia certyfikaty Google? Google w swoim oświadczeniu ogranicza się do skąpego w detale komunikatu, że fałszywy certyfikat był wykorzystywany do “inspekcji szyfrowanego ruchu poprzez komercyjne urządzenie działające w prywatnej sieci i za zgodą jej użytkowników“. Z lektury nieocenionego Reddita dowiemy się jednak, że winnym jest tak naprawdę francuskie Ministerstwo Finansów, któremu ANSSI przekazała klucz pośredniego CA (dzięki temu mogli generować “zaufane” certyfikaty dla dowolnych domen). Zaufane w tym kontekście oznacza, że takie certyfikaty nie wzbudzają żadnego komunikatu z ostrzeżeniem w przeglądarce (cała ścieżka certyfikacji była poprawna i zaufana — tyle tylko, że certyfikat GMaila nie był tym, z którego Google korzysta na codzień). ANSSI opublikowała już oświadczenie w tej sprawie, z którego wynika, że… był to “błąd ludzki”: Jak Google odkryło fałszywy certyfikat? Przeglądarka Google Chrome wykorzystuje tzw. Certificate Pinning, czyli hardkodowanie fingerprintu klucza w kodzie programu. Oprócz zwyczajnej weryfikacji ścieżki zaufania w ramach PKI, Google Chrome sprawdza także, czy jest to rzeczywiście ten certyfikat, który wykorzystują na swoich serwerach …i zapewne od razu raportuje wykrycie innego klucza do centrali. Pinning zaimplementowany w Google po ataku na Comodo jest w zasadzie jedyną ochroną przed problemami związanymi z zaufaniem w infrastrukturze CA/PKI — ale Google przecież nie będzie zaszywał w kodzie ID wszystkich serwisów na świecie działających po HTTPS – robi to dla kilku największych (tu lista), dzięki czemu może np. wykrywać podsłuchiwanie Facebooka w Syrii, czy trwające prawie 2 miesiące rozszyfrowywanie ruchu do 500+ serwisów w Iranie, kiedy to na skutek włamania do DigiNotar wygenerowano tak ciekawe certyfikaty jak pasujące do domen *.*.com… Jak ty możesz się chronić przed podstawieniem fałszywego certyfikatu? W zasadzie pierwszym krokiem, powinno być usunięcie z systemowego (i przeglądarkowego) magazynu root CA, tych certyfikatów, którym nie ufasz (firmy dokonują “inspekcji”, czyli tak naprawdę podsłuchu połączeń swoich pracowników poprzez wstrzyknięcie własnego CA do magazynów certyfikatów na stacjach roboczych). Niestety, przeglądanie magazynu pod kątem niezaufanych certyfikatów nie jest wcale takie proste — nazwy i powiązania są zbyt enigmatyczne dla przeciętnego Kowalskiego, a dodatkowo, nie zawsze można usunąć root CA z urządzenia, nawet jeśli należy do organizacji wojskowej innego kraju. Nie mówiąc już o tym, że usunięty certyfikat pewnie wróci po aktualizacji programu… Użytkownicy Firefoksa mogą jednak skorzystać z rozszerzenia Certificate Patrol, które zapamiętuje fingerprinty certyfikatów SSL na odwiedzanych przez nas stronach i ostrzega, jeśli zmienią się przy kolejnej wizycie. Godny uwagi w tym kontekście jest również Convergence oraz Perspectives-project jak i projekt Google o nazwie Certificate Transparency. Jeśli jesteś developerem aplikacji mobilnej, warto zahardkodować fingerprint certyfikatu w swojej aplikacji — w zasadzie tylko to gwarantuje, że połączenie nie będzie dało się podsłuchać. Urządzenia mobilne (a raczej niektóre biblioteki kryptograficzne przez nie wykorzystywane) mają to do siebie, że często nie pokazują użytkownikom komunikatów błędów związanych z certyfikatami SSL — po cichu je akceptując. PKI jest zepsute, to nie pierwszy problem tego typu Warto nadmienić, że fałszywe certyfikaty są przede wszystkim generowane w wyniku włamań do infrastruktury zaufanych urzędów certyfikacyjnych. Tak było w przypadku Comodo, potem izraelskiego StartSSL-a i DigiNotar. W przypadku wpadki francuskiego Ministerstwa Finansów zagrożenia dla globalnego internetu raczej nie było. Nie zmienia to jednak faktu, że ten incydent kolejny raz pokazuje, jak niedopracowanym, pod kątem bezpieczeństwa, jest współcześnie wykorzystywany model PKI. ,igH