Ciekawą metodę hackowania bankomatów zaprezentowano na trwającym właśnie konwencie CCC. Wystarczy bankomat z Windowsem (większość bankomatów pracuje pod kontrolą tego systemu), pendrive z odpowiednim skryptem i sprytne wymuszenie restartu bankomatu. Klasyczne skimmery i eksplozje bankomatów są nudne Zazwyczaj słysząc o kolejnym złodziejskim ataku na bankomat, na myśl przychodzą popularne skimmery lub tzw. “metoda na Polaka”, polegająca na wysadzaniu bankomatów w powietrze. Tego typu zdarzenia opisywaliśmy już wielokrotnie na naszych łamach. Atak, który zaprezentujemy poniżej wnosi pewien powiew świeżości i finezji (choć do kreatywności metody “na widelec” jeszcze mu daleko). Warto również podkreślić, że niniejszy atak nie jest zupełną nowością — już 3 lata temu opisywaliśmy kultowy numer Barnaby Jacka, pozwalający zainstalować rootkit w bankomacie poprzez podpięcie się do portu USB bankomatu. Kiedy jednak Barnaby Jack prezentował swoje odkrycia, z opisywanych przez niego metod nie korzystała wówczas jeszcze żadna grupa przestępcza — teraz sytuacja uległa zmianie. Mało tego, szajka rabusiów jest podobno na tle groźna, że analizujący ich metody badacze, w obawie o swoje zdrowie, nie zdecydowali się na ujawnienie tożsamości (występowali pod pseudonimami tw i sb, ale pokazali się z odkrytymi twarzami na scenie). Tajemnicze, puste bankomaty Wszystko zaczęło się, kiedy jeden z banków zaczął otrzymywać coraz więcej doniesień o totalnie wyczyszczonych z gotówki bankomatach. Bankowcy zauważyli, że maszyny na krótko przed wyczyszczeniem na chwilę odpinały się od bankowych systemów monitoringu, ale nie mieli bladego pojęcia jak gotówka znika z bankomatu (logi maszyn były wyczyszczone). Postanowiono więc wzmocnić monitoring CCTV wokół bankomatów i dzięki temu odkryto, że złodzieje korzystają z pendrive’a do infekcji bankomatu złośliwym oprogramowaniem. Jednego z rabusiów złapano na gorącym uczynku, dzięki czemu uzyskano dostęp do zainfekowanego pendrive’a. Jak przebiega atak na bankomat? Złodziej najpierw wyłamuje kawałek obudowy dokładnie w tym miejscu, w którym znajduje się port USB przeznaczony dla drukarki. (Tak precyzyjne działanie wskazuje na to, że złodzieje najprawdopodobniej posiadali swobodny dostęp do jakiegoś egzemplarza bankomatu, no cóż, wolnostojące potrafią znikać…). Do portu USB podpina pendrive’a, na którym znajduje się popularny system ratunkowy Hirens. Złodziej wymusza restart bankomatu. Można to zrobić albo przez odcięcie zasilania albo przez wyjęcie na chwilę kabla sieciowego. W trakcie restartu, złodziej zmienia kolejność bootowania i wskazuje podpięty przez siebie dysk USB jako dysk startowy. Tu kłania się brak podstawowego hardeningu publicznie dostępnej maszyny. Czyżby firmy obsługujące bankomaty zakładały, że fizyczny dostęp do komputera bankomatu nie jest możliwy? Bankomat jest teraz pod obsługą tzw. mini WinXP i automatycznie startuje skrypt o nazwie …hack.bat. Badacze początkowo myśleli, że nazwa skryptu jest zbyt oczywista i jest to podpucha, ale życie pokazało, że trop był jak najbardziej poprawny. Jak wypłacano gotówkę z zainfekowanego bankomatu? Infekcja bankomatu to dopiero początek — przestępcy ciągle muszą się jakoś dostać do sejfu i znajdujących się w nim kasetek z banknotami. Złośliwe oprogramowanie zgrywa z bankomatu pewne dane (fragmenty rejestru Windows, oraz pliki zawierające informacje dotyczące wykonywanych transakcji kartowych), ale również uruchamia własny kod służący do obsługi bankomatu i m.in. podmienia ekrany z menu bankomatu na coś takiego: Podmienione menu bankomatu pojawia się tylko po wpisaniu kodu 000507607999 (warto więc sprawdzić przy najbliższej wizycie w bankomacie, czy rabusie nie dotarli do Polski). Co ciekawe, z alternatywnego, złodziejskiego menu wcale nie jest tak łatwo zmusić bankomat do wydania gotówki. Odpowiedni przycisk, służący do “wyczyszczenia” bankomatu nie uruchamia dyspensera, a wyświetla na ekranie losową liczbę. Przestępca musi zadzwonić do “bazy”, przedyktować liczbę i wpisać na klawiaturze otrzymany od bazy, a wygenerowany na jej podstawie kod. Dopiero wtedy może przystąpić do wypłaty. Rabusie dobrze chronią swój kod Warto podkreślić, że alternatywne oprogramowanie napisane przez rabusiów jest ściśle dostosowane do konkretnych bankomatów. Co ciekawe, złośliwe funkcje są zaszyfrowane (XOR) kluczem o wartości odpowiadającej tzw. VolumeSerial, czyli unikatowemu numerowi przypisywanemu przez system operacyjny podczas formatowania dysku. Innymi słowy, złośliwy kod jest przygotowywany pod konkretny egzemplarz bankomatu. Dodatkowo aplikacja rabusiów stosuje techniki utrudniające jej reverse engineering. Jakby tego było mało, malware wyposażony jest w narzędzie do bezpiecznego usuwania danych i zaraz po ataku skrzętnie po sobie sprząta odinstalowując się i nadpisując dysk tak, aby uniemożliwić analizę powłamaniową. Aby proces był łatwiejszy — w samym menu znajduje się opcja czyszczenia, która pokazuje taki przyjazny ekranik: Co ciekawe, bankomat można wyleczyć wpisując kod: 000507607999000753951000 Kto stoi za atakami? Tego nie wiadomo. Badacze nie ujawnili nazwy banku, który padł ofiarą rabusiów i poprosił ich o analizę złośliwego kodu. SG i TW nie zaprezentowali także hipotez co do tożsamości złodziejów, ale postawili tezę, że malware jest wynikiem ich stałej “etatowej” pracy. Rabusie są też najprawdopodobniej powiązani z pracownikami firmam obsługujących bankomaty — doskonale wiedzieli z jakich zabezpieczeń korzysta bankomat, i że whitelisting aplikacji stosowany jako formę ochrony systemu bankomatu przed infekcją można oszukać poprzez ładowanie pliku .dll. Struktura kodu (zwłaszcza zabezpieczenia kodu i wymóg podawania challange-response przed wypłatą) wskazuje na to, że szajka jest wielopoziomowa, a osoby które wypłacają pieniądze z bankomatów to tak naprawdę ściśle kontrolowane pionki, które nie mają zbyt wielkiej wiedzy na temat “serca” całego procederu. Powyższy przypadek to też cudowne zobrazowanie zasady “im prościej, tym lepiej”. Mimo, że rabusie mogliby również za pomocą swojego oprogramowania zczytywać paski magnetyczne kart i PIN-y, to wybrali (co logiczne) łatwiejszą i szybszą drogę wzbogacenia się — bezpośrednią wypłatę z bankomatu. Ten atak to także przypomnienie, że jeśli ktoś ma fizyczny dostęp do twojego sprzętu, to nie jest to już twój sprzęt… PS. Nagranie całego wykładu możecie znaleźć tutaj (ID prezentacji to: 5476). Z kolei streaming trwającej jeszcze dziś i jutro konferencji znajdziecie tu — warto obserwować, sporo ciekawych tematów jeszcze w rozkładzie jazdy. PPS. Badacze w swojej prezentacji przywołali też przypadek podobnego, ale mniej zaawansowanego, złośliwego oprogramowania atakującego bankomaty. Ploutus, bo o nim mowa, infekował bankomaty poprzez CD-ROM i również prowadził do wyprowadzania gotówki z kasetek. ,igH