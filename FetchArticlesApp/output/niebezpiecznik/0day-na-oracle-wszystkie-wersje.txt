Do śmiesznego zdarzenia doszło podczas ostatniego, kwietniowego patchowania produktów Oracle. Firma podziękowała jednemu z researcherów, który myśląc, że zgłoszony przez niego błąd został załatany opublikował szczegóły ataku. Okazało się jednak, że błąd nie został usunięty i wszystkie wersje Oracla są na niego podatne. A ponieważ nie ma patcha, administratorzy baz danych muszą sobie radzić sami… Fatalna pomyłka Oracle Przy wypuszczeniu ostatnich 88 łatek na produkty Oracle, firma podziękowała Joxeanowi Koretowi, który w 2008 (sic!) roku zgłosił “krytyczny” błąd. Koret opublikował więc szczegóły podatności i opisał jak można ją wyexploitować. Kilka dni później zorientował się jednak, że błąd nie został załatany (a dokładniej: będzie załatany dopiero w wersji 12) a więc wszystkie obecne wersje bazy Oracle pomiędzy 8i to 11g R2 są na niego podatne. Oracle TNS Poison Na co pozwala błąd wykryty przez Koreta? Na zdalne przekierowanie przez atakującego ruchu kierowanego do bazy danych na inny serwer. Atakujący musi jedynie znać Oracle SID lub Oracle service name serwera bazodanowego Oracle, którego ruch chce przechwycić. Serwery DB Oracle korzytają z osobnego procesu-listenera (TCP/1521). Żądania klientów są przez ten proces przekierowywane do faktycznej bazy danych. Od wersji 8i procesy te mogą spawnować dodatkowe listenery. Krótko mówiąc, Koret znalazł sposób na to, jak zarejestrować swój złośliwy listener, który zostanie zinterpretowany jako część mechanizmu load balancing bazy danych Oracle — dzięki czemu część ruchu do bazy będzie przez niego przechodziła. Oczywiście ruch ze “złośliwego” listenera można przekierować na serwer atakującego co pozwala na podsłuchiwanie połączeń kierowanych do serwera bazdanowego Oracle. Jak zabezpieczyć bazę Oracle? Jeśli nie korzystasz z clusteringu, ustaw dynamic_registration = off w listener.ora. W przypadu korzystania z clusteringu, należy ograniczyć dostęp do listenera tak, aby nie był dostępny z internetu lub LAN-u — przydatne opcje: TCP.VALIDNODE_CHECKING oraz TCP.INVITED_NODE. Jeśli masz wykupione Oracle Advanced Security, warto włączyć SSL/TLS w protocol.ora lub sqlnet.ora za pomocą dyrektyw: SQLNET.ENCRYPTION_CLIENT=REQUIRED i SQLNET.ENCRYPTION_SERVER=REQUIRED. Patrząc na udzielone Koretowi wymówki na pytanie kiedy błąd rzeczywiście zostanie usunięty (“strasznie trudne do zbackportnowania“, “nasi klienci nie chcą tego typu patchy” (!?), “błąd leży w bardzo wrażliwym fragmencie kodu“), można się spodziewać, że nie nastąpi to zbyt szybko… ,vi.curry