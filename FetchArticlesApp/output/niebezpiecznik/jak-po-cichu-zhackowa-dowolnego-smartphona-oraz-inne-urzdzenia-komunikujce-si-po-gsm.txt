Na zakończonej właśnie konferencji BlackHat, badacze Mathew Solnik i Marc Blanchou zaprezentowali ciekawe błędy w implementacji wykorzystywanych globalnie przez operatorów GSM protokołów kontrolnych. Za ich pomocą można przejąć kontrolę nad większością urządzeń, które łączą się z siecią GSM (a także CDMA oraz LTE) i po cichu zainstalować własne oprogramowanie, co prowadzi do podsłuchiwania użytkownika, kradzieży jego danych albo przydatnego służbom ominięcia wbudowanych zabezpieczeń systemowych, np. blokady ekranu. Funkcje te przypominają w działaniu całkiem sprawnego backdoora. Czym są protokoły kontrolne? Większość urządzeń bezprzewodowych takich jak smartphony, tablety, laptopy, routery/hotspoty, ale także i samochody, posiada wbudowany baseband, a dzięki temu także obsługę tzw. protokołów kontrolnych (por. OMA-DM). Protokoły te umożliwiają zdalnie zarządzanie urządzeniami (tzw. provisioning), z czego chętnie korzystają operatorzy GSM — wysyłają tak: aktualizacje oprogramowania (tzw. OTA update), włączają bądź wyłączają konkretne funkcje urządzeń, np. funkcję kamery lub połączeń z Wi-Fi zbierają z nich komunikaty o błędach (por. Większość telefonów komórkowych na podsłuchu Na poniższym diagramie możecie zobaczyć jak wygląda komunikacja z urządzeniami mobilnymi (Android i iOS) oraz parsowanie komunikatów OMA-DM. Za parsowanie komunikatów OMA-DM wysyłanych przez operatorów odpowiadają klienty OMA-DM, które dla większości urządzeń dostarcza firma RedBend (vDirect Mobile OMA-DM Client). Klienty są binarną paczką, a więc większość odbiorców (marek produkujących sprzęt) nawet do końca nie wie, co dodaje do swojego urządzenia. Oto lista producentów korzystających z vDirect od RedBend: Po pierwszej instrukcji otrzymanej od operatora, klient OMA-DM “wybudza się” i nawiązuje połączenie ze skonfigurowanym serwerem, pobierając dalsze instrukcje (np. wykonanie aktualizacji oprogramowania, wyłączenie/włączenie jakiejś funkcji, itp.) Przejmowanie kontroli nad iPhonami, Androidami, Blackberry i Windows Mobile Cały atak został odkryty przez przypadek. Kiedy Solnik czytał instrukcję obsługi jednego z bezprzewodowych protokołów kontrolnych M2M (ang. machine to machine) zauważył w niej interesujący fragment: Solnik wraz z Blanchou zreversowali więc firmware urządzeń mobilnych, szukając wszystkiego co może komunikować się poprzez OMA-DMI: Badacze zbudowali też własną, laboratoryjną sieć GSM (w oparciu o NanoBTS i femtokomórki), którą wykorzystali do fuzzingu: Warto jednak podkreślić, że dzięki możliwości wysyłania komunikatów WAP (inicjujących komunikację OMA-DMI) z jednego urządzenia do drugiego, atakujący wcale nie potrzebują włamywać się do sieci operatora lub stawiać własnego fałszywego BTS-a. Podsumowując, wystarczy, że atakujący wyśle jeden komunikat WAP push i ma dostęp do odczytania konfiguracji lub rekonfiguracji basebandu danego urządzenia. Co może zrobić atakujący? Możliwości jest kilka… Zmodyfikować użytkownikowi APN i serwery proxy (przechwytując tym samym jego ruch). Na niektórych urządzeniach taka zmiana przetrwa tzw. “reset do ustawień fabrycznych”. Świetny sposób na inwigilację. Wyłączyć funkcję np. aparatu/kamery w telefonie. Przyda się przy zamieszkach. Zainstalować/odinstalować aplikację APK Modyfikować NVRAM urządzenia Ominąć blokadę ekranu (przyda się zwłaszcza zapominalskim, albo służbom ;) Odczytać zawartość pamięci urządzenia (wykorzystując wcześniej błąd “integer overflow” w obsłudze WBXML przez urządzenie), przy okazji omijając mechanizm ASLR, co pozwala m.in. na… Wykonanie jailbreaka iPhona poprzez GSM, (o ile działa na firmware do 7.04): Wykonanie poniższych ataków wymaga uwierzytelnienia, do którego potrzebny jest login )(czyli IMEI urządzenia; nadawane otwarcie, więc łatwo można je przechwycić) oraz …statyczny token (taki sam dla wszystkich urządzeń danego operatora). Dodatkowo, jeden z błędów odkrytych przez badaczy pozwolił im na ominięcie wymogu szyfrowania procesu uwierzytelnienia — wystarczyło wysłać komunikat WAP wymuszający użycie jednego z zahardkodowanych serwerów testowych, który komunikował się po …HTTP (czyli bez szyfrowania). Co robić, jak żyć? Najbardziej bezpieczni (pod kątem powyższych ataków) są ci z Was, którzy posiadają telefony niepowiązane z żadnym z operatorów (tzw. “unlocked phones”, bez “simlocka”) — większość z nich nie ma zmodyfikowanego basebandu pod konkretną infrastrukturę danego operatora. Badacze poinformowali o odkrytych przez siebie błędach zarówno firmy tworzące klientów OMA, jak i producentów telefonów. Część z nich załatała już niektóre dziury, ale to według badaczy nie rozwiązuje sprawy — sam protokół komunikacji powinien zostać zmieniony ponieważ wadliwa jest jego architektura. Ale taka zmiana nie będzie prosta — do wypracowania porozumienia nad nowym standardem musiałoby przystąpić wiele firm… W sieci dostępny jest już zapis całego wykładu badaczy: BlackPhone też padł… Na marginesie, w trakcie konferencji BlackHat padł także Blackphone, czyli wyprodukowany przez Silent Circle smartphone pracujący pod kontrolą Androida, stworzony specjalnie po to, aby był “niepdosłuchiwalny” przez NSA. Blackphona zrootowany dzięki 3 atakom — włączenie ADB, wykorzystanie tego, że funkcja “zdalnego kasowania pamięci telefonu” została skompilowana w sposób ułatwiający debugging oraz błędu, którego jeszcze nie ujawniono. Przeprowadzenie ataku można wykonać albo na bardzo naiwnym użytkowniku albo na własnym telefonie. PS. Dla osób, których są zainteresowane bezpieczeństwem urządzeń mobilnych, zwłaszcza od strony software’owej mamy przygotowane dedykowane szkolenie pt. Bezpieczeństwo Aplikacji Mobilnych — zostały jeszcze tylko 4 wolne miejsca na jego najbliższą edycję w Warszawie w dn. 28-29 sierpnia. ,vi.curry