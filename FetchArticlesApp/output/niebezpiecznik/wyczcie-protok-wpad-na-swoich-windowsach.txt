Badacze ostrzegają przed atakami MITM na protokół WPAD (Web Proxy Auto-Discovery), które pozwalają wykraść wrażliwe dane ofiary, nawet jeśli ofiara korzysta z tzw. “bezpieczych” i szyfrowanych połączeń, np. HTTPS lub VPN. Atak jest istotny, ponieważ WPAD uruchamia się po podpięciu do niezaufanych (pozafirmowych) sieci, np. po połączeniu z darmowym hotspotem w restauracji. Na czym polega atak? Atak polega na podstawieniu w lokalnej sieci pliku PAC wskazującego na serwer proxy kontrolowany przez atakującego. Oto przykładowa zawartość takiego pliku: function FindProxyForURL(url, host) { // dla lokalnych adresów łącz się bezpośrednio: if (shExpMatch(host, "*.example.com")) { return "DIRECT"; } // wszystkie inne przez port 8080 serwera proxy.example.com a jak nie wyjdzie, to bezpośrednio return "PROXY proxy.example.com:8080; DIRECT"; } Lokalizacja pliku PAC jest przez komputery z włączonym WPAD-em wykrywana na kilka sposobów (poprzez DHCP z opcją 252, DNS w domenach wpad.nasza.firma.pl, wpad.firma.pl lub LLMNR). Po podstawieniu własnych namiarów na serwer proxy przez plik PAC, atakujący jest w stanie przechwytywać całość niezaszyfrowanego ruchu ofiary. A co z protokołami szyfrowanymi (jak HTTPS)? Poprzez odpowiednie instrukcje w plikach PAC możliwe jest poznanie zapytań DNS-owych z komputera ofiary oraz przechwycenie pełnego URL-a, do którego odwołuje się ofiara. Jeśli więc adres jakiegoś zasobu HTTPS zawiera parametry z wrażliwymi danym, wpadną one w ręce atakującego. Dzięki temu, atakujący może przechwycić tokeny OAuth lub prywatne zdjęcia użytkownika z Facebooka (ich adresy to publiczne CDN-y, a “restrykcja” w dostępie polega na przewidzeniu nazwy — w przypadku możliwości podglądania URL-i, atakujący pozna nazwę pliku na CDN). Co ciekawe, jeśli ofiara została zaatakowana (jej serwery proxy są podstawione przez złośliwy WPAD), to niektóre klienty VPN (np. OpenVPN) będą z nich korzystać. Żeby było śmieszniej, z racji tego, że komputery szukają serwerów WPAD w domenach lokalnych, które teraz można kupić jako globalne, możliwe jest masowe “rekonfigurowanie” i przechwytywanie danych, np. od wszystkich użytkowników konkretnego routera. Tu przykład domeny używanej przez routery jednej z firm: fritz.box: Mam Windows — co robić, jak żyć? Jeśli ktoś z was musi korzystać z WPAD, ustawcie statyczny adres serwera, a plik PAC serwujcie po HTTPS. Jeśli nie wiecie, co to jest WPAD, to znak, że pewnie w ogóle nie musicie z niego korzystać. W takiej sytuacji najlepsze będzie jego wyłączenie. Oto instrukcje dla Windowsa wyłączające próbkowanie WPAD: Internet Options (control panel) > Connections > LAN Settings > odznacz Automatically detect settings lub Zmodyfikuj “HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Wpad” -> “Wpad” Dodając DWORD (32-Bit Value) o nazwie “WpadOverride” z wartością “1”. Prezentacja dotycząca niebezpieczeństw związanych z WPAD jest tutaj. A tutaj jest druga. ,vi.curryBadacze ostrzegają przed atakami MITM na protokół WPAD (Web Proxy Auto-Discovery), które pozwalają wykraść wrażliwe dane ofiary, nawet jeśli ofiara korzysta z tzw. “bezpieczych” i szyfrowanych połączeń, np. HTTPS lub VPN. Atak jest istotny, ponieważ WPAD uruchamia się po podpięciu do niezaufanych (pozafirmowych) sieci, np. po połączeniu z darmowym hotspotem w restauracji. Na czym polega atak? Atak polega na podstawieniu w lokalnej sieci pliku PAC wskazującego na serwer proxy kontrolowany przez atakującego. Oto przykładowa zawartość takiego pliku: function FindProxyForURL(url, host) { // dla lokalnych adresów łącz się bezpośrednio: if (shExpMatch(host, "*.example.com")) { return "DIRECT"; } // wszystkie inne przez port 8080 serwera proxy.example.com a jak nie wyjdzie, to bezpośrednio return "PROXY proxy.example.com:8080; DIRECT"; } Lokalizacja pliku PAC jest przez komputery z włączonym WPAD-em wykrywana na kilka sposobów (poprzez DHCP z opcją 252, DNS w domenach wpad.nasza.firma.pl, wpad.firma.pl lub LLMNR). Po podstawieniu własnych namiarów na serwer proxy przez plik PAC, atakujący jest w stanie przechwytywać całość niezaszyfrowanego ruchu ofiary. A co z protokołami szyfrowanymi (jak HTTPS)? Poprzez odpowiednie instrukcje w plikach PAC możliwe jest poznanie zapytań DNS-owych z komputera ofiary oraz przechwycenie pełnego URL-a, do którego odwołuje się ofiara. Jeśli więc adres jakiegoś zasobu HTTPS zawiera parametry z wrażliwymi danym, wpadną one w ręce atakującego. Dzięki temu, atakujący może przechwycić tokeny OAuth lub prywatne zdjęcia użytkownika z Facebooka (ich adresy to publiczne CDN-y, a “restrykcja” w dostępie polega na przewidzeniu nazwy — w przypadku możliwości podglądania URL-i, atakujący pozna nazwę pliku na CDN). Co ciekawe, jeśli ofiara została zaatakowana (jej serwery proxy są podstawione przez złośliwy WPAD), to niektóre klienty VPN (np. OpenVPN) będą z nich korzystać. Żeby było śmieszniej, z racji tego, że komputery szukają serwerów WPAD w domenach lokalnych, które teraz można kupić jako globalne, możliwe jest masowe “rekonfigurowanie” i przechwytywanie danych, np. od wszystkich użytkowników konkretnego routera. Tu przykład domeny używanej przez routery jednej z firm: fritz.box: Mam Windows — co robić, jak żyć? Jeśli ktoś z was musi korzystać z WPAD, ustawcie statyczny adres serwera, a plik PAC serwujcie po HTTPS. Jeśli nie wiecie, co to jest WPAD, to znak, że pewnie w ogóle nie musicie z niego korzystać. W takiej sytuacji najlepsze będzie jego wyłączenie. Oto instrukcje dla Windowsa wyłączające próbkowanie WPAD: Internet Options (control panel) > Connections > LAN Settings > odznacz Automatically detect settings lub Zmodyfikuj “HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Wpad” -> “Wpad” Dodając DWORD (32-Bit Value) o nazwie “WpadOverride” z wartością “1”. Prezentacja dotycząca niebezpieczeństw związanych z WPAD jest tutaj. A tutaj jest druga. ,vi.curryBadacze ostrzegają przed atakami MITM na protokół WPAD (Web Proxy Auto-Discovery), które pozwalają wykraść wrażliwe dane ofiary, nawet jeśli ofiara korzysta z tzw. “bezpieczych” i szyfrowanych połączeń, np. HTTPS lub VPN. Atak jest istotny, ponieważ WPAD uruchamia się po podpięciu do niezaufanych (pozafirmowych) sieci, np. po połączeniu z darmowym hotspotem w restauracji. Na czym polega atak? Atak polega na podstawieniu w lokalnej sieci pliku PAC wskazującego na serwer proxy kontrolowany przez atakującego. Oto przykładowa zawartość takiego pliku: function FindProxyForURL(url, host) { // dla lokalnych adresów łącz się bezpośrednio: if (shExpMatch(host, "*.example.com")) { return "DIRECT"; } // wszystkie inne przez port 8080 serwera proxy.example.com a jak nie wyjdzie, to bezpośrednio return "PROXY proxy.example.com:8080; DIRECT"; } Lokalizacja pliku PAC jest przez komputery z włączonym WPAD-em wykrywana na kilka sposobów (poprzez DHCP z opcją 252, DNS w domenach wpad.nasza.firma.pl, wpad.firma.pl lub LLMNR). Po podstawieniu własnych namiarów na serwer proxy przez plik PAC, atakujący jest w stanie przechwytywać całość niezaszyfrowanego ruchu ofiary. A co z protokołami szyfrowanymi (jak HTTPS)? Poprzez odpowiednie instrukcje w plikach PAC możliwe jest poznanie zapytań DNS-owych z komputera ofiary oraz przechwycenie pełnego URL-a, do którego odwołuje się ofiara. Jeśli więc adres jakiegoś zasobu HTTPS zawiera parametry z wrażliwymi danym, wpadną one w ręce atakującego. Dzięki temu, atakujący może przechwycić tokeny OAuth lub prywatne zdjęcia użytkownika z Facebooka (ich adresy to publiczne CDN-y, a “restrykcja” w dostępie polega na przewidzeniu nazwy — w przypadku możliwości podglądania URL-i, atakujący pozna nazwę pliku na CDN). Co ciekawe, jeśli ofiara została zaatakowana (jej serwery proxy są podstawione przez złośliwy WPAD), to niektóre klienty VPN (np. OpenVPN) będą z nich korzystać. Żeby było śmieszniej, z racji tego, że komputery szukają serwerów WPAD w domenach lokalnych, które teraz można kupić jako globalne, możliwe jest masowe “rekonfigurowanie” i przechwytywanie danych, np. od wszystkich użytkowników konkretnego routera. Tu przykład domeny używanej przez routery jednej z firm: fritz.box: Mam Windows — co robić, jak żyć? Jeśli ktoś z was musi korzystać z WPAD, ustawcie statyczny adres serwera, a plik PAC serwujcie po HTTPS. Jeśli nie wiecie, co to jest WPAD, to znak, że pewnie w ogóle nie musicie z niego korzystać. W takiej sytuacji najlepsze będzie jego wyłączenie. Oto instrukcje dla Windowsa wyłączające próbkowanie WPAD: Internet Options (control panel) > Connections > LAN Settings > odznacz Automatically detect settings lub Zmodyfikuj “HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Wpad” -> “Wpad” Dodając DWORD (32-Bit Value) o nazwie “WpadOverride” z wartością “1”. Prezentacja dotycząca niebezpieczeństw związanych z WPAD jest tutaj. A tutaj jest druga. ,vi.curry