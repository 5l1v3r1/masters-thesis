Rzadko zdarza nam się zachwycać kunsztem atakujących, bo przytłaczająca większość masowych ataków to nudne phishingi i oklepane błędy w webaplikacjach albo małofinezyjne DDoS-y. Tym razem jednak jesteśmy pełni podziwu dla pomysłowości atakującego, który przy pomocy fałszowania tras BGP przejmował wykopywaną kryptowalutę Bitcoin i DOGE. Przechwycono ruch od 19 operatorów Na ślad ataku trafili badacze z Della. Informują oni, że atakującemu, który kontrolował router znajdujący się w serwerowni jednego z kanadyjskich ISP, udało się za pomocą wstrzykniętych przez siebie prefiksów BGP przekierować na swoje serwery ruch związany z kopaniem kryptowaluty. Przechwycony ruch pochodził z 57 podsieci od 19 ISP. Wśród ofiar znalazły się serwerownie Amazon, DigitalOcean i OVH. Ataków w sumie było 22, i były one bardzo krótkie — fałszywe trasy wstrzykiwano na zaledwie 30 sekund (pełną listę dat ataków i przechwyconych prefiksów znajdziecie tutaj). To jednak wystarczyło, aby klienci, którzy wymieniali w tym czasie dane z tzw. “kopalnią” (tzw. “górnicy”), zostali przekierowani i zapamiętali nowy, podstawiony przez atakującego adres IP jako adres kopalni aż do momentu restartu komputera. Fałszywa kopalnia także zlecała górnikom zadania do obliczenia (na tym polega “kopanie” kryptowaluty), ale nie nagradzała za odesłanie odpowiedzi. Z hijackingiem tras BGP mieliśmy już do czynienia. Technika wcale nie jest innowacyjna. Ruch internautów do znanych usług przejmowała Białoruś i Islandia oraz Chiny (i to wielokrotnie). Niektóre z ataków na BGP były też przykrywane trwającymi w tym samym czasie bardziej widocznymi (i odciągającymi uwagę) atakami DDoS (por. atak DDoS/BGP na Spamhaus). Atak przeszedł w większości niezauważony, bo większość górników nie sprawdzała statystyk wydobycia codziennie… Były jednak osoby, które już w marcu zauważyły nieprawidłowości — oto post jednego z użytkowników forum Bitcointalk.org: Atakujący działał od lutego 2014 roku do końca maja i miał uzyskiwać ze swojego procederu ok. 9 000 dolarów dziennie (28 000 PLN). Potwierdzono, że przez rachunki powiązane z atakującym przepłynęło w sumie ok. 83 000 dolarów (260 000 PLN). Dane te nie są jednak pewne, bo pracownik Della …złamał kostkę w trakcie projektu i z tego powodu zaprzestał monitoringu. Oto wykres prezentujący potwierdzone transakcje z rachunków skojarzonych z atakującym: Kto stoi za tym atakiem? Fałszywe trasy BGP były wstrzykiwane przez router jednego z kanadyjskich ISP. Badacze nie podają jego nazwy, bo nie są pewni, czy za atakiem stał jeden z pracowników ISP, czy router został “zhackowany” przez kogoś z zewnątrz. Mógł to także być były pracownik firmy — wielokrotnie opisywaliśmy “komputerowe zemsty” jakich dopuszczali się zwolnieni pracownicy, por. były pracownik hackuje konto spółki na giełdzie papierów wartościowych i wysyła obraźliwy komunikat do akcjonariuszy, zwolniony admin zostawił 2700 backdoorów na serwerach swojej firmy, Zwolniony pracownik skasował serwery firmy Gucci. Kopię kryptowalutę — co robić, jak żyć? O ile przed samym przejęciem routingu z perspektywy użytkownika końcowego średnio możemy się zabezpieczyć, to pewien stopień ochrony zapewnia korzystanie z szyfrowanych protokołów. Nasz ruch zawsze może być przechwycony w przypadku udanego “porwania trasy BGP” — zostanie wysłany na inne serwery, a być może także przejdzie przez złośliwe serwery NSA, które będą chciały go modyfikować “w locie”, wstrzykując weń exploity (z takiej techniki skorzystało FBI w atakau na Free Hosting w sieci Tora). Jeśli jednak nasz ruch jest szyfrowany to atakujący nie będzie w stanie go podejrzeć i zmodyfikować. Koparki BitCoinów najwyraźniej nie zaimplementowały poprawnie kryptografii… Większość koparek korzysta z protokołu o nazwie (nomen omen) Stratum, który nie wspiera szyfrowania, ani nie zapewnia integralności przesyłanym danym, co oczywiście umożliwia ataki MITM. Patrząc na pasmo spektakularnych faili osób związanych z kantorami i innymi usługami dotyczącymi kryptowalut, jakoś specjalnie nas nie dziwi wykorzystanie tak kiepskiego protokołu do kluczowych operacji koparek… Por. Dziura na giełdzie Bitmarket i mocne wahnięcie kursu, Bitcurex — polska giełda BTC zhackowana, Polska giełda Bitextreme okradziona, Awaria Bitomat.pl: Polacy stracili swoje Bitcoiny, Kradzież Bitcoinów przez telewizor Największa giełda Mt.Gox zamknięta przez dziurę w protokole — milionowe straty, Aby monitorować zmiany w naszych prefiksach BGP można skorzystać z usługi BGPMON, która umożliwia monitoring 5 prefiksów za darmo Inne dziury w koparkach kryptowalut Jeśli chcecie przeczytać ciekawe opracowanie błędów w popularnym oprogramowaniu do kopania kryptowalut (zwłaszcza SGMiner, CGMiner i BFGminer), zachęcamy do lektury tego dokumentu (oraz tego, tego i tego) — po ich lekturze, być może niektórym z was na myśl przyjdą jeszcze bardziej spektakularne ataki niż zatruwanie tras BGP… :-) ,igH