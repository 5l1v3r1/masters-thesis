Jeśli do zmiennej w skrypcie PHP przypiszemy następującą wartość numeryczną: 2.2250738585072011e-308, to jest spora szansa na to, że skrypt najpierw pożre 100% zasobów procesora, a potem zaliczy crasha. Błąd jest o tyle uciążliwy, że za jego pomocą można zawieszać większość internetowych webaplikacji napisanych w PHP — wystarczy przekazać powyższą liczbę w URL-u jako parametr GET. 2.2250738585072011e-308: PHP x87 FPU bug Za DoS w PHP odpowiedzialna jest funkcja zend_strod() konwertująca liczby zmiennoprzecinkowe. Wprowadza ona systemy Linux, Windows i FreeBSD w nieskończoną pętlę. Na atak podatne są architektury wykorzystujące koprocesor FPU z zestawem instrukcji x87 (o ile PHP nie skompilowano z flagami: -mfpmath=sse lub -ffloat-store, bo tak naprawdę całemu złu winny jest bug w gcc). Aby sprawdzić, czy twój serwer i instalacja PHP są podatne, stwórz i odpal skrypt o następującej zawartości: <?php $d = 2.2250738585072011e-308; ?> Warto nadmienić, że inne sposoby zapisu tej liczby również powodują ten sam błąd: 0.22250738585072011e-307 22.250738585072011e-309 22250738585072011e-324 Ataki na aplikacje internetowe Najgorsze w tym wszystkim jest jednak to, że błąd występuje w wielu popularnych serwisach internetowych i webaplikacjach, np. forum phpBB: /phpBB3/viewforum.php?f=2.2250738585072011e-308 …i zapewne w setkach innych webaplikacji, które przyjmują (traktują) parametr jako liczbę (zmiennoprzecinkową) — na myśl przychodzi mi np. wyszukiwanie produktów po cenach… Na szczęście w większości przypadków błąd nie jest straszny — CPU podskoczy do 100%, PHP na chwilę się powiesi, a potem zostanie zrestartowane. Jak się zabezpieczyć przed błędem w PHP? Developerzy PHP już przygotowali poprawkę. Można też przekompilować sobie PHP z wykorzystaniem flag -mfpmath=sse lub -ffloat-store. Jeśli jednak ktoś z was chciałby się na szybko zabezpieczyć przed atakami DoS na PHP, polecamy wrzucić powyższą linijkę na początku skryptu PHP: if (strpos(str_replace('.', '', serialize($GLOBALS)), '22250738585072011')!==false) die(); Nie jest to oczywiście jedyna metoda ochrony webaplikacji przed atakami typu DoS. Na naszych szkoleniach zdradzamy kilka innych, sprytniejszych… :-) Aktualizacja 7.01.2011 Krzysztof Rakowski informuje, że Zend rozesłał newsletter dotyczący błędu. Hotfix dla Windows tu, a instrukcja dot. Linuksa tu podesłał WRonX ,Piotr Konieczny